{% extends "base.html" %}

{% block title %}{{ block.super }} - トップ{% endblock %}

{% block script %}
<script type="text/javascript">

$(function() {

	$.ajax({
		type: "POST",
		url: "/ajax/mail/",
	}).done(function( t ) {
		$('.ml').text(t).attr('href', 'mailto:'+t)
	}).fail(function(jqXHR, textStatus, errorThrown){
		alert(errorThrown)
	});
	bg_flip()
    update_bg()


    $('.box').addClass('glass')
    {%if css3%}
    $('.bg').addClass('bg-css3')
    {%endif%}
});	

var bg_files = new Array(
	'{{STATIC_URL}}img/hero/1.jpg',
	'{{STATIC_URL}}img/hero/2.jpg',
	'{{STATIC_URL}}img/hero/3.jpg',
	'{{STATIC_URL}}img/hero/4.jpg',
	'{{STATIC_URL}}img/hero/5.jpg');

var bg_fade_duration = 2000
var bg_fade_interval = 10000

var bg_imgs = new Array(bg_files.length);
for (i = 0; i < bg_files.length; i++) {
	bg_imgs[i] = null
}
var bg_index = Math.floor( Math.random() * 5 );

var bg_flip_index = false
var bg_front
var bg_back


function bg_file(){
	return bg_files[bg_index]
}
function bg_img(){
	return bg_img[bg_index]
}
function bg_proceed(){
	if (bg_index < bg_files.length-1 ) {
		bg_index = bg_index + 1;
	}else{
		bg_index = 0
	}
	return bg_index
}
function bg_flip(){
	bg_flip_index = ! bg_flip_index
	if(bg_flip_index){
		bg_front = $('#bg-a')
		bg_back = $('#bg-b')
	}else{
		bg_front = $('#bg-b')
		bg_back = $('#bg-a')
	}	
	bg_front.addClass('bg-front')
	bg_front.removeClass('bg-back')
	bg_back.addClass('bg-back')
	bg_back.removeClass('bg-front')
}

function update_bg(){
	console.log('update')
	if (bg_img()==null) {
		var img = new Image()
		img.onload=function() {
			bg_img[bg_index] = img
			console.log('loaded '+img.src)
			setTimeout(update_bg, 10);
		}
		img.src = bg_file()
		return
	}

	{%if css3%}

	bg_back.css('background-image', 'url("' + bg_img().src + '")')
	console.log('attached '+ bg_img().src + ' to '+ bg_back.attr('id'))

	bg_flip()
	bg_proceed()
	setTimeout(update_bg, bg_fade_interval);
	{%else%}
	bg_back.attr('src', bg_img().src)
	bg_back.data('orgWidth', bg_img().width)
	bg_back.data('orgHeight', bg_img().height)
	adjust_bg(bg_back)

	bg_back.show()
	bg_front.fadeOut(
		bg_fade_duration,
		function(){
			console.log('fade done')
			bg_flip()
			bg_proceed()
			setTimeout(update_bg, bg_fade_interval);
		}
	)
	{%endif%}

}


function adjust_bg(img){
	var body = $("body")
	var body_w = body.width()
	var body_h = body.height()
	var img_w = img.data('orgWidth')
	var img_h = img.data('orgHeight')
	if ( body_w/body_h > img_w/img_h){
		var h = body_w * img_h / img_w
		img.css({width: body_w, height: h, top: -(h - body_h)/2, left: 0 })
	}else{
		var w = body_h * img_w / img_h
		img.css({width: w, height: body_h, top: 0, left: -(w - body_w)/2})
	}
}

function resize(){    
	{%if not css3%}
	adjust_bg(bg_front)
	adjust_bg(bg_back)
	{%endif%}
}

var timer = false;
$(window).resize(function() {
    if (timer !== false) {
        clearTimeout(timer);
    }
    timer = setTimeout(resize, 200);
});
	
</script>
{% endblock %}

{%block pre_process%}
<div id="bg-container">
	{%if css3%}
	<div id="bg-a" class="bg"></div>
	<div id="bg-b" class="bg"></div>
	{%else%}
	<img id="bg-a" class="bg" style="opacity:1;" />
	<img id="bg-b" class="bg" style="opacity:1;" />
	{%endif%}
</div>
{%endblock%}

{% block content %}

<div class="box">

	<div class="flex-contents">

		<article class="flex-content flex4 p12 pickup article-body">
			<h1>フラテ山の会は、新入部員を募集しています！</h1>
			<p>この年新しく北大生となった新入生のみなさん、ご入学おめでとうございます。北大医学部山岳部・フラテ山の会は、部員を募集しています。
			ガイダンスの際に配布したビラをお持ちの方は、そこに食事会の日程が書いてありますので、少しでも興味があるという方は是非参加してみてください。ビラは持ってないけど、ホームページを見てちょっと興味があるかもという方も、<a class="ml">xxxxxxxxxxxxxxxxxxx</a>までご連絡ください！</p>
			<p>　また、4月中は毎週末、新歓登山も行っています。こちらもビラに記載されたメールアドレスか上記までご連絡ください。
			<div class="bordered">				
				<p>※フラテ山の会には以下のような方が<strong>向いて</strong>います。</p>
				<ul>
					<li>山が好き → いくらでも登れます。登りたい山も先輩が連れて行きます</li>
					<li>きれいな景色が好き → 北大の医学部のサークルの中最も美しい景色が見られます</li>
					<li>温泉が好き → 下山後は必ず温泉で汗を流します。登った山の数だけ温泉にいけます</li>
					<li>部活には入りたいけどどこもピンと来ない → 山の会にはあなたのような部員がたくさんいます</li>
				</ul>
			</div>

		</article>

		<article class="flex-content flex3 p12">
			<h1>フラテ山の会のホームページをリニューアルしました。</h1>
			<p>OB/OGの方は変更に伴うお知らせがあります。<a href="{%url "bbs.thread.show" 1%}">こちら</a>を御覧ください。</p>
			<p>　鍵マーク付きのスレッドの閲覧にはログインが必要になります。ユーザー名・パスワードについては、<a href="http://frate.bbs.fc2.com/">今までのパスワード付き掲示板</a>に詳しい説明を書いておきましたので、そちらを御覧ください。</p>
			<p>　また、古いホームページ等は上のメニューの「その他」からアクセス可能です。</p>
		</article>

		<article class="flex-content flex2 p12">
			<h1>フラテ山の会とは？</h1>
			<p>フラテ山の会は、別名:北海道大学医学部山岳部です。軽登山・沢登り・ロッククライミング・山スキーなど、四季にわたって精力的に活動しています。例会は月曜日の18:00からで、山行は基本的に自由参加です。サークルや部活との掛け持ちも可能です。新入生の皆様は是非、見学に来てください。</p>
			<table class="table-default bg-white">
				<tr>
					<th class="bg-gray">住所</th>
					<td>
						<p>〒060-0814<br />
						北海道札幌市北区北14条西5丁目<br />
						医学部部室棟</p>
					</td>
				</tr>
				<tr>
					<th class="bg-gray">メールアドレス</th>
					<td><a class="ml">xxxxxxxxxxxxxxxxxxx</a></td>
				</tr>
			</table>
		</article>

		<article class="flex-content flex2 p12">
			<h1>更新情報</h1>

			<table class="table-default  bg-white">
				<tr>
					<th>2014年4月3日</th>
					<td><a href="http://frate.web.fc2.com/">旧ホームページ</a>から新ホームページに自動転送するようにしました。</td>
				</tr>
				<tr>
					<th>2014年3月15日</th>
					<td>ホームページをリニューアルしました。</td>
				</tr>
			</table>					
				
		</article>

	</div>

</div>	

{% endblock %}
